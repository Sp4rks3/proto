syntax = "proto3";

package clientpb;
option go_package = "github.com/chainreactors/malice-network/proto/client/clientpb";

import "implant/commonpb/common.proto";
import "listener/lispb/listener.proto";


message Empty {}

message Basic {
  int32 major = 1;
  int32 minor = 2;
  int32 patch = 3;

  string commit = 4;
  bool dirty = 5;
  int64 compiledAt = 6;

  string os = 7;
  string arch = 8;
}

message Session {
  string session_id = 1;
  string name = 2;
  string remote_addr = 3;
  bool is_dead = 4;
  string version = 5;
  string listener_id = 6;
  commonpb.Os os = 11;
  commonpb.Process process = 12;
  commonpb.Timer timer = 13;
  repeated Task tasks = 14;
}

message Sessions {
  repeated Session sessions = 1;
}

message Job {
  uint32 id = 1;
  lispb.Pipeline pipeline = 2;
}

message Jobs {
  repeated Job job = 1;
}

message JobCtrl {
  uint32 id = 1;
  int32 ctrl = 2;
  Job job = 3;
}

message JobStatus {
  string listener_id = 1;
  int32 ctrl = 2;
  int32 status = 3;
  string error = 4;
  Job job = 5;
}

message Listener{
  string id = 1;
  string addr = 2;
  bool active = 3;
  repeated lispb.Pipeline pipelines = 4;
}

message Listeners {
  repeated Listener listeners = 1;
}

message Client {
  uint32 ID = 1;
  string Name = 2;
  bool Online = 3;
}

message Clients {
  repeated Client clients = 1;
}

message Event {
  string type = 1;
  bytes data = 2;
  string source = 3;
  string err = 4; // Can't trigger normal gRPC error
  Session session = 5;
  Job job = 6;
  Client client = 7;
  Task task = 8;
}

message KillJobReq {
  uint32 id = 1;
}

message KillJob {
  uint32 id = 1;
  bool success = 2;
}

message RegisterReq {
  string host = 1;
  string user = 2;
}

message LoginReq {
  string host = 1;
  uint32 port = 2;
  string name = 3;
  string token = 4;
}

message LoginResp {
  bool success = 1;
}

message RegisterResp {
  bytes certs = 1;
  bytes private_key = 2;
  bytes ca = 3;
}

message Sync{
  string name = 1;
  string target = 2;
}

message SyncResp {
  Task task = 1;
  string target = 2;
  bytes content = 3;
}

message Task{
  uint32 task_id = 1;
  string session_id = 2;
  string type = 3;
  int32 status = 4;
  int32 cur = 5;
  int32 total = 6;
  string error = 7;
  bytes data = 8;
}

message Tasks{
  repeated Task tasks = 1;
}

message Kits {
  repeated Kit kits = 1;
}

message Kit{
  string name = 1;
  bytes content = 2;
}

message Plugins {
  repeated Plugin plugins = 1;
}

message Plugin{
  string name = 1;
  bytes content = 2;
}
